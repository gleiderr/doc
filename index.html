<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-16">
	<title>Graphit üñâ</title>
</head>

<style type="text/css">
	.nodo {
		border-left: solid;
		border-left-width: 1px;
		border-left-style: dotted;
		padding-left: 13px;
	}
	.referencia {
		border-left-color: cornflowerblue;
		font-size: small;
		background: aliceblue;
	}
	.expansivel {
		cursor: pointer;
	}
	.expansivel::before {
		content: '‚ñ∏';
		margin-left: -13px;
	}
	.expandido::before {
		content: '‚ñæ';
		margin-left: -13px;
	}
</style>
<body>
	<script type="text/javascript">
		let json = null;

		init();

		class Graphit {
			constructor (obj, id) {
				this.obj = obj;
				this.id = id;
				this.node = obj[id];
			}

			get children() {
				let a = [];
				if(this.node.content) {
					for(let i = 0; i < this.node.content.length; i++) {
						a.push(new Graphit(this.obj, this.node.content[i]));
					}
				}
				return a;
			}

			get neighborhood() {
				let es = [];
				if (this.node.edges){
					for (let edge of this.node.edges) {
						let edge_text = edge[0];
						let node = new Graphit(this.obj, edge[1]);
						es.push({edge_text, node});
					}
				}
				return es;
			}

			get data() {
				return this.node.data;
			}

			hasContent() {
				return Boolean(this.node.content && this.node.content.length);
			}

			hasEdges() {
				return Boolean(this.node.edges && this.node.edges.length);
			}
		}
		
		function handle(files) {
			var reader = new FileReader();
			reader.onload = (e) => {
				json = JSON.parse(e.target.result);
				graphit(JSON.parse(e.target.result));
			};

			reader.readAsText(files[0]);
		}

		function init() {
			let input = document.createElement('div');
			input.innerHTML = '<input id="input" type="file" name="" accept=".json" oninput="handle(this.files)">';
			input = input.firstChild;

			document.body.innerHTML = '';
			document.body.appendChild(input);
		};

		function graphit(json) {
			init();
			//Exibe conte√∫do de "0" em uma filha de <body>
			let first = new Graphit(json, '0');
			document.body.appendChild(ell(first, `<div class="nodo">${first.data}</div>)`));

			document.body.addEventListener('click', event => {
				if(event.target.classList.contains('expansivel')) {
					event.target.classList.remove('expansivel');
					event.target.classList.add('expandido');
					expand(event.target);
				}
				event.stopPropagation();
			});
		}		

		function ell(node, content) {
			let e = document.createElement('div');
			e.innerHTML = content;

			e = e.firstChild;
			e.setAttribute('data-nodo', node.id);

			if(node.hasEdges() || node.hasContent()) e.classList.add('expansivel');

			return e;
		}

		function expand(element) {
			let n = new Graphit(json, element.getAttribute('data-nodo'));

			//Exibi√ß√£o das refer√™ncias
			for(let neighbor of n.neighborhood) {
				let content = '<div class="nodo referencia">'
							  +	`${neighbor.edge_text}: ${neighbor.node.data}`
							  + '</div>';
				element.appendChild(ell(neighbor.node, content));
			}

			//Exibi√ß√£o do conte√∫do
			for (let child of n.children){
				element.appendChild(ell(child, `<div class="nodo">${child.data}</div>`));
			}
		}
	</script>
</body>
</html>
