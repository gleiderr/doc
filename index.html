<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-16">
	<title>Graph-it</title>
</head>

<style type="text/css">
	.nodo {
		border-left: solid;
		border-left-width: 1px;
		border-left-style: dotted;
		padding-left: 13px;
	}
	.referencia {
		border-left-color: cornflowerblue;
		font-size: small;
		background: aliceblue;
	}
</style>
<body>
	<input id="input" type="file" name="" accept=".json" oninput="handle(this.files)">
	<script type="text/javascript">
		let json = null;

		class Graphit {
			constructor (obj, id) {
				this.obj = obj;
				this.id = id;
				this.node = obj[id];
			}

			get children() {
				let a = [];
				if(this.node.content) {
					for(let i = 0; i < this.node.content.length; i++) {
						a.push(new Graphit(this.obj, this.node.content[i]));
					}
				}
				return a;
			}

			get next() {
				if(this.obj[this.id].next) return new Graphit(this.obj, this.node.next);
				return null;
			}

			get neighborhood() {
				let es = [];
				if (this.node.multi_edges){
					for (let multi_edge of this.node.multi_edges) {
						let text = multi_edge[0];
						for(let i = 1; i < multi_edge.length; i++) {
							let to = new Graphit(this.obj, multi_edge[i]);
							es.push({text, to});
						}
					}
				}
				return es;
			}

			get text() {
				return this.node.text;
			}
		}
		
		function handle(files) {
			var reader = new FileReader();
			reader.onload = (e) => {
				json = JSON.parse(e.target.result);
				graphit(JSON.parse(e.target.result));
			};

			reader.readAsText(files[0]);
		}

		function graphit(json) {
			//Exibe conte√∫do de "0" em uma div filha de <body>
			let root = document.createElement("div");

			let n = new Graphit(json, "0");
			let e = ell(n.text, '<div class="nodo"></div>)');
			root.appendChild(e);

			for(let neighbor of n.neighborhood) e.appendChild(ell(neighbor.text, '<div class="nodo referencia"></div>'));

			for (let child of n.children) e.appendChild(ell(child.text, '<div class="nodo"></div>'));

 			let p = e.parentNode;
 			for (let next = n.next; next; next = next.next) {
 				p.appendChild(ell(next.text, '<div class="nodo"></div>'));
 				next = next.next;
 			}

			/*let e = document.createElement("div");
			e.innerHTML = n.text;


			for(let i = 0; i < n.content; i ++) {
				let n_aux = json[n.content[i]];
				newChild = document.createElement("div");
				newChild.innerHTML = n_aux.text;
				e.append(newChild.firstChild);
			}
			
			let n_aux = n;
			while(n_aux = json[n_aux.next]) {
				newChild = document.createElement("div");
				newChild.innerHTML = n_aux.text;
				while(newChild.firstChild){
					if(typeof newChild.firstChild == 'string') {
						root.appendChild(document.createTextNode(newChild.firstChild));
					} else {
						root.appendChild(newChild.firstChild);
					}
				}
			}*/

			document.body.append(root);
		}

		function ell(text, tag = '<div></div>') {
			let e = document.createElement('div');
			e.innerHTML = tag;

			e = e.firstChild;
			e.innerHTML = text;
			return e;
		}
	</script>
</body>
</html>
